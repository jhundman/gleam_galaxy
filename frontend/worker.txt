const FRONTEND_HOST = 'your-sveltekit-app.pages.dev'
const BACKEND_HOST = 'your-backend-api.fly.dev'

export default {
  async fetch(request, env, ctx) {
    const url = new URL(request.url);
    const path = url.pathname + url.search;

    return handleRequest(request, path);
  },
};

async function handleRequest(request, path) {
  const targetHost = path.startsWith('/api/') ? BACKEND_HOST : FRONTEND_HOST;

  const targetUrl = `https://${targetHost}${path}`;

  const modifiedRequest = new Request(targetUrl, {
    method: request.method,
    headers: request.headers,
    body: request.body,
  });

  // Forward the request to the target host
  const response = await fetch(modifiedRequest);

  // Return the response as-is
  return response;
}
